<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–°–≤–æ—è –∏–≥—Ä–∞ ‚Äî –ö—É–ª—å—Ç—É—Ä–∞ –∏ —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–∏</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap');
    :root {
      --primary-glow: #ffd700;
      --secondary-glow: #4a9eff;
      --bg-dark: #000041ff;
      --bg-mid: #000c8cff;
      --bg-light: #02046eff;
      --text-light: #fff;
      --text-dim: #b0d4ff;
      --success-glow: #28a745;
      --error-glow: #dc3545;
    }
    * { box-sizing: border-box; }
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, var(--bg-light) 0%, var(--bg-mid) 50%, var(--bg-dark) 100%);
      color: var(--text-light);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      overflow-x: hidden;
      position: relative;
      padding: 20px;
    }
    .bg-animation { position: absolute; inset: 0; overflow: hidden; z-index: 0; opacity: 0.25; }
    .bg-symbol {
      position: absolute;
      font-size: 2rem;
      color: var(--primary-glow);
      font-weight: 300;
      animation: floatSymbol 15s infinite linear;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
      user-select: none;
    }
    @keyframes floatSymbol {
      0% { transform: translateY(110vh) rotate(0deg); opacity: 0; }
      5% { opacity: 0; }
      15% { opacity: 1; }
      85% { opacity: 1; }
      95% { opacity: 0; }
      100% { transform: translateY(-20vh) rotate(360deg); opacity: 0; }
    }
    .screen {
      text-align: center;
      z-index: 10;
      position: relative;
      animation: fadeIn 0.8s ease;
      max-width: 1200px;
      width: 100%;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .logo-container { margin-bottom: 2em; }
    .title {
      font-size: 3.5rem;
      font-weight: 700;
      color: var(--primary-glow);
      margin: 0;
      letter-spacing: 12px;
      text-transform: uppercase;
      text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
    }
    .subtitle {
      font-size: 1.1rem;
      color: #e4e000ff;
      margin-top: 1em;
      font-weight: 300;
      letter-spacing: 2px;
    }
    .settings-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(74, 158, 255, 0.2);
      border: 1px solid rgba(74, 158, 255, 0.4);
      color: var(--primary-glow);
      padding: 0.8em 1.5em;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      z-index: 20;
    }
    .settings-btn:hover {
      background: rgba(74, 158, 255, 0.3);
      transform: translateY(-2px);
    }
    .teams {
      margin: 2em 0;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2em;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }
    .team-box {
      background: rgba(74, 158, 255, 0.08);
      border: 1px solid rgba(74, 158, 255, 0.3);
      border-radius: 8px;
      padding: 2em 1.5em;
      transition: all 0.3s ease;
    }
    .team-box:hover {
      background: rgba(74, 158, 255, 0.12);
      border-color: rgba(74, 158, 255, 0.5);
      transform: translateY(-3px);
    }
    .team-label {
      font-size: 0.9rem;
      color: var(--primary-glow);
      margin-bottom: 1em;
      font-weight: 400;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    input, select {
      padding: 0.9em 1.2em;
      border-radius: 6px;
      border: 1px solid rgba(74, 158, 255, 0.4);
      outline: none;
      background: rgba(10, 37, 64, 0.6);
      color: var(--text-light);
      font-size: 1rem;
      width: 100%;
      text-align: center;
      transition: all 0.3s ease;
      font-weight: 300;
    }
    input[type="range"] { padding: 0; }
    input::placeholder { color: rgba(255, 255, 255, 0.4); }
    input:focus, select:focus {
      border-color: var(--secondary-glow);
      background: rgba(10, 37, 64, 0.8);
      box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.1);
    }
    input:disabled { opacity: 0.5; cursor: not-allowed; }
    .buttons { margin-top: 2em; }
    .big-btn {
      background: var(--secondary-glow);
      color: var(--text-light);
      border: none;
      padding: 1em 3em;
      font-size: 1.1rem;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 0.5em;
      font-weight: 400;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 4px 15px rgba(74, 158, 255, 0.3);
    }
    .big-btn:hover {
      background: #3a8eef;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(74, 158, 255, 0.4);
    }
    .hint {
      font-size: 0.95rem;
      color: var(--text-dim);
      margin-top: 2em;
      font-weight: 300;
    }
    .hidden { display: none !important; }
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      justify-content: center;
      align-items: center;
      transition: opacity 0.3s ease;
      z-index: 500;
      backdrop-filter: blur(8px);
    }
    .modal.hidden { opacity: 0; pointer-events: none; }
    .modal-content {
      background: linear-gradient(135deg, #01047e 0%, #020a5f 100%);
      border: 1px solid rgba(255, 215, 0, 0.4);
      border-radius: 12px;
      padding: 1.5em 2.5em;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      animation: modalAppear 0.4s ease;
      min-width: 400px;
      max-width: 600px;
    }
    @keyframes modalAppear {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    .modal-content h2 {
      font-size: 1.8rem;
      color: var(--primary-glow);
      margin-bottom: 1em;
      font-weight: 400;
      letter-spacing: 2px;
    }
    .settings-group { margin: 1.2em 0; text-align: left; }
    .settings-group label { display: block; color: var(--text-dim); margin-bottom: 0.5em; font-size: 0.9rem; }
    .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; inset: 0; background-color: rgba(10, 37, 64, 0.6); transition: .4s; border-radius: 34px; border: 1px solid rgba(74, 158, 255, 0.4); }
    .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: var(--secondary-glow); }
    input:checked + .slider:before { transform: translateX(26px); }
    .coin {
      width: 140px;
      height: 140px;
      position: relative;
      margin: 2em auto;
      transform-style: preserve-3d;
      transition: transform 2.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    .face {
      position: absolute; width: 100%; height: 100%; border-radius: 50%;
      display: flex; align-items: center; justify-content: center; font-weight: 400; font-size: 1.2rem;
      backface-visibility: hidden; background-size: cover; background-position: center;
      box-shadow: 0 8px 30px rgba(74, 158, 255, 0.4); border: 3px solid rgba(255, 215, 0, 0.4); color: var(--text-light);
    }
    .heads { background-image: url('https://media.discordapp.net/attachments/1344289233447419926/1427219340033265794/coin_heads.png?ex=68ee1117&is=68ecbf97&hm=8ba24400fb08c9927b09987c0daafa199b727f2e357cdd30196ca0067460c9c9&=&format=webp&quality=lossless&width=640&height=640'); }
    .tails { transform: rotateY(180deg); background-image: url('https://media.discordapp.net/attachments/1344289233447419926/1427219340574461993/coin_tails.png?ex=68ee1117&is=68ecbf97&hm=08414785dee1287ab484dd629ea1f50e1858f0fb2f212a1c9f175a67f4ab5244&=&format=webp&quality=lossless&width=640&height=640'); }
    .result {
      font-size: 1.4rem; color: var(--primary-glow); margin-top: 1.5em; font-weight: 400;
      animation: resultAppear 0.4s ease; text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
    }
    @keyframes resultAppear {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    .small-btn {
      background: transparent; color: var(--secondary-glow); border: 1px solid var(--secondary-glow);
      padding: 0.8em 1.5em; font-size: 0.9rem; border-radius: 6px; cursor: pointer; transition: all 0.3s ease;
      font-weight: 400; text-transform: uppercase; margin: 0.25em; letter-spacing: 1px;
    }
    .small-btn:hover { background: var(--secondary-glow); color: var(--text-light); transform: translateY(-2px); }
    .small-btn:disabled {
      opacity: 0.4; cursor: not-allowed; border-color: rgba(74, 158, 255, 0.4);
      color: rgba(74, 158, 255, 0.4); background: transparent; transform: none;
    }
    header {
      font-size: 2.5rem; font-weight: 700; color: var(--primary-glow); letter-spacing: 8px; text-transform: uppercase;
      text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3); display: flex; justify-content: space-between;
      align-items: center; margin-bottom: 1.5em; flex-wrap: wrap; gap: 1em;
    }
    header h1 { flex: 1; text-align: center; margin: 0; font-size: 2.8rem; min-width: 200px; }
    #turn-indicator {
      color: var(--primary-glow); font-size: 1.3rem; font-weight: 600; margin-bottom: 20px;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.4);
    }
    .team {
      font-size: 1.1rem; text-align: center; color: var(--text-light); background: rgba(74, 158, 255, 0.1);
      padding: 10px 20px; border-radius: 8px; border: 1px solid rgba(74, 158, 255, 0.3);
      box-shadow: 0 0 10px rgba(74, 158, 255, 0.2); min-width: 180px; transition: all 0.4s ease;
    }
    .team.active-team {
        background: rgba(255, 215, 0, 0.15); border-color: rgba(255, 215, 0, 0.6);
        transform: scale(1.05); box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
    }
    .team-name { color: var(--primary-glow); font-weight: 600; margin-bottom: 4px; }
    .team-score-wrapper { display: flex; align-items: center; justify-content: center; gap: 10px; }
    .team-score { font-size: 1.3rem; font-weight: 700; }
    .score-btn {
      background: rgba(74, 158, 255, 0.3); border: 1px solid rgba(74, 158, 255, 0.5);
      color: var(--text-light); width: 24px; height: 24px; border-radius: 50%;
      cursor: pointer; font-size: 1rem; line-height: 22px; transition: all 0.2s ease; padding: 0;
    }
    .score-btn:hover { background: var(--secondary-glow); transform: scale(1.1); }
    .team-lifelines {
        font-size: 0.9rem; color: var(--text-dim); margin-top: 8px; display: flex;
        gap: 15px; justify-content: center; align-items: center;
    }
    #board { display: flex; flex-direction: column; gap: 12px; z-index: 10; margin-bottom: 2em; }
    .category-title {
      background: rgba(74, 158, 255, 0.08); border: 1px solid rgba(74, 158, 255, 0.3); border-radius: 8px;
      padding: 8px; font-size: 0.95rem; color: var(--primary-glow); text-align: center; text-transform: uppercase;
      letter-spacing: 0.5px; font-weight: 500; line-height: 1.2;
    }
      .value-btn {
        background: rgba(10, 37, 64, 0.6); border: 1px solid rgba(74, 158, 255, 0.4); color: var(--text-light);
        font-size: 1.1rem; border-radius: 6px; cursor: pointer; transition: all 0.3s ease; text-align: center;
        padding: 0.8em; font-weight: 400;
      }
    .value-btn:hover {
      background: var(--secondary-glow); border-color: var(--secondary-glow);
      transform: translateY(-3px); box-shadow: 0 0 10px rgba(74, 158, 255, 0.4);
    }
    .value-btn.used {
      background: rgba(255, 255, 255, 0.1); color: #777; pointer-events: none; box-shadow: none; transform: none;
    }
    #question-box {
      display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); justify-content: center; align-items: center;
      flex-direction: column; text-align: center; z-index: 100; backdrop-filter: blur(8px); padding: 20px;
    }
    #timer-display {
      position: absolute; top: 30px; font-size: 3rem; color: var(--primary-glow); font-weight: 700;
      text-shadow: 0 0 15px rgba(255,215,0,0.5);
    }
    .modal-timer {
      font-size: 3.5rem;
      color: var(--primary-glow);
      font-weight: 700;
      margin: 0.5em 0;
      text-shadow: 0 0 15px rgba(255,215,0,0.5);
    }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    #timer-display.low-time { color: var(--error-glow); animation: pulse 1s infinite; }
    #media-container { max-width: 90%; margin: 0 auto 15px; }
    #media-container img { max-width: 100%; max-height: 30vh; border-radius: 8px; border: 2px solid var(--primary-glow); }
    #media-container audio { width: 100%; max-width: 400px; margin-top: 10px; }
    #question {
      font-size: 1.8rem; margin-top: 10px; margin-bottom: 20px; color: var(--primary-glow);
      max-width: 800px; padding: 0 20px;
    }
    .options {
      display: grid; grid-template-columns: repeat(2,1fr); gap: 15px; width: 80%;
      max-width: 700px; margin: 0 auto 20px auto;
    }
    .option-btn {
      background: rgba(10,37,64,0.6); border: 1px solid rgba(74,158,255,0.4); color: var(--text-light);
      border-radius: 6px; padding: 1em; cursor: pointer; transition: all 0.3s ease; font-size: 1rem;
    }
    .option-btn:hover:not(:disabled) { background: var(--secondary-glow); transform: translateY(-2px); }
    .option-btn.fifty-fifty-hidden { visibility: hidden; pointer-events: none; opacity: 0.3; }
    .option-btn.correct { background: rgba(40, 167, 69, 0.6); border-color: var(--success-glow); }
    .option-btn.incorrect { background: rgba(220, 53, 69, 0.6); border-color: var(--error-glow); }
    #host-controls { display: flex; gap: 20px; margin-top: 20px; }
    .host-btn-correct { background-color: var(--success-glow); border-color: var(--success-glow); }
    .host-btn-correct:hover { background-color: #218838; }
    .host-btn-incorrect { background-color: var(--error-glow); border-color: var(--error-glow); }
    .host-btn-incorrect:hover { background-color: #c82333; }
    #lifeline-controls { display: flex; justify-content: center; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
    #answer-feedback {
        position: fixed; inset: 0; z-index: 1000; display: flex; justify-content: center; align-items: center;
        font-size: 10rem; font-weight: 900; text-transform: uppercase; animation: feedback-anim 2s forwards; pointer-events: none;
    }
    #answer-feedback.correct { color: var(--success-glow); text-shadow: 0 0 20px var(--success-glow); }
    #answer-feedback.incorrect { color: var(--error-glow); text-shadow: 0 0 20px var(--error-glow); }
    @keyframes feedback-anim {
        0% { transform: scale(0.5); opacity: 0; } 20% { transform: scale(1.1); opacity: 1; }
        80% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.5); opacity: 0; }
    }
    #final-result {
      display: none; position: fixed; inset: 0; z-index: 1000; background: rgba(0,0,0,0.9); color: var(--primary-glow);
      justify-content: center; align-items: center; flex-direction: column;
      font-size: 2rem; text-shadow: 0 0 15px rgba(255,215,0,0.6);
    }
    .game-controls { margin-top: 1em; display: flex; gap: 1em; justify-content: center; flex-wrap: wrap; }
    .control-btn {
      background: rgba(74, 158, 255, 0.2); border: 1px solid rgba(74, 158, 255, 0.4); color: var(--primary-glow);
      padding: 0.6em 1.2em; border-radius: 6px; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem;
    }
    .control-btn:hover { background: rgba(74, 158, 255, 0.3); transform: translateY(-2px); }
    .control-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .confetti-piece {
      position: fixed; width: 10px; height: 20px; z-index: 9999; top: -20px; opacity: 0;
      animation: confetti-fall 5s linear forwards;
    }
    @keyframes confetti-fall {
        0% { transform: translateY(0vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
    }
    .lifeline-settings {
        display: grid; grid-template-columns: 1fr auto; gap: 10px 20px; align-items: center;
        background: rgba(0,0,0,0.2); padding: 1em; border-radius: 8px;
    }
    .lifeline-settings label { margin: 0; font-size: 1rem; color: var(--text-light); }
    .lifeline-settings select { width: 120px; }
    
    @media (max-width: 768px) {
        body { padding: 10px; } .title { font-size: 2.5rem; letter-spacing: 6px; } .subtitle { font-size: 1rem; }
        .settings-btn { top: 10px; right: 10px; padding: 0.6em 1em; } .teams { grid-template-columns: 1fr; gap: 1.5em; }
        header { flex-direction: column; gap: 1em; margin-bottom: 1em; } header h1 { font-size: 1.8rem; letter-spacing: 4px; order: -1; }
        .team { width: 100%; max-width: 320px; margin: 0 auto; } #board { gap: 15px; }
        #board > div { display: grid !important; grid-template-columns: 1fr 1fr !important; gap: 8px !important; }
        .category-title { grid-column: 1 / -1 !important; margin-bottom: 5px; font-size: 1rem; padding: 10px; }
        .value-btn { font-size: 1rem; padding: 0.9em; } #question-box { padding: 15px; }
        #timer-display { font-size: 2.5rem; top: 15px; } #question { font-size: 1.3rem; max-width: 100%; padding: 0; }
        .options { width: 100%; gap: 10px; } .option-btn { font-size: 0.9rem; }
        .modal-content { width: 95%; min-width: 0; padding: 1.5em; } .modal-content h2 { font-size: 1.5rem; }
        #final-result { font-size: 1.5rem; padding: 15px; } #answer-feedback { font-size: 5rem; }
    }
    @media (max-width: 420px) {
        .title { font-size: 2rem; letter-spacing: 4px; }
        .big-btn { padding: 0.8em 1.5em; font-size: 1rem; width: 100%; max-width: 280px; margin: auto; }
        .options { grid-template-columns: 1fr; } #question { font-size: 1.2rem; }
    }
  </style>
</head>
<body>
  <div class="bg-animation" id="bgAnimation"></div>

  <div id="start-screen" class="screen">
    <button class="settings-btn" onclick="showSettings()">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    <div class="logo-container">
      <h1 class="title">–°–í–û–Ø –ò–ì–†–ê</h1>
      <p class="subtitle">–ö—É–ª—å—Ç—É—Ä–∞ –∏ —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–∏</p>
    </div>
    <div class="teams">
      <div class="team-box">
        <div class="team-label">–ö–æ–º–∞–Ω–¥–∞ 1</div>
        <input id="teamA" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã" />
      </div>
      <div class="team-box">
        <div class="team-label">–ö–æ–º–∞–Ω–¥–∞ 2</div>
        <input id="teamB" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã" />
      </div>
    </div>
    <div class="buttons">
      <button id="confirmBtn" class="big-btn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
      <button id="playBtn" class="big-btn hidden">–ë—Ä–æ—Å–∏—Ç—å –∂—Ä–µ–±–∏–π</button>
    </div>
    <p class="hint">–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥ –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã</p>
  </div>

  <div id="game-screen" class="screen hidden">
    <header>
      <div class="team" id="team1">
        <div class="team-name" id="team1-name"></div>
        <div class="team-score-wrapper">
            <button class="score-btn" onclick="adjustScore('team1', -100)">-</button>
            <div class="team-score" id="team1-score">0</div>
            <button class="score-btn" onclick="adjustScore('team1', 100)">+</button>
        </div>
        <div class="team-lifelines">
          <span>50/50: <b id="team1-fiftyFifty"></b></span>
          <span>–ó–≤0–Ω–∫–æ–≤: <b id="team1-phoneAFriend"></b></span>
        </div>
      </div>
      <h1>–°–í–û–Ø –ò–ì–†–ê</h1>
      <div class="team" id="team2">
        <div class="team-name" id="team2-name"></div>
        <div class="team-score-wrapper">
            <button class="score-btn" onclick="adjustScore('team2', -100)">-</button>
            <div class="team-score" id="team2-score">0</div>
            <button class="score-btn" onclick="adjustScore('team2', 100)">+</button>
        </div>
        <div class="team-lifelines">
          <span>50/50: <b id="team2-fiftyFifty"></b></span>
          <span>–ó–≤0–Ω–∫–æ–≤: <b id="team2-phoneAFriend"></b></span>
        </div>
      </div>
    </header>
    <div id="turn-indicator"></div>
    <div id="board"></div>
    <div class="game-controls">
      <button class="control-btn" onclick="showSettings()"> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
      <button class="control-btn" onclick="resetGame()"> –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    </div>
  </div>

  <div class="modal hidden" id="settingsModal">
    <div class="modal-content">
      <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã</h2>
      <div class="settings-group" style="display: flex; justify-content: space-between; align-items: center;">
          <label for="host-mode-toggle">–†–µ–∂–∏–º –≤–µ–¥—É—â–µ–≥–æ (—É—Å—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç):</label>
          <label class="switch">
              <input type="checkbox" id="host-mode-toggle">
              <span class="slider"></span>
          </label>
      </div>
      <div class="settings-group">
        <label for="volume-control">–ì—Ä–æ–º–∫–æ—Å—Ç—å –º—É–∑—ã–∫–∏:</label>
        <input type="range" id="volume-control" min="0" max="1" step="0.05" value="0.1">
      </div>
      <div class="settings-group">
        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –Ω–∞ –∫–æ–º–∞–Ω–¥—É:</label>
        <div class="lifeline-settings">
          <label for="lifelines-count-fifty">50/50</label>
          <select id="lifelines-count-fifty">
            <option value="1">1</option><option value="2">2</option><option value="3" selected>3</option><option value="unlimited">‚àû</option>
          </select>
          <label for="lifelines-count-phone"> –ó–≤–æ–Ω–æ–∫ –¥—Ä—É–≥—É</label>
          <select id="lifelines-count-phone">
            <option value="1" selected>1</option><option value="2">2</option><option value="3">3</option><option value="unlimited">‚àû</option>
          </select>
        </div>
      </div>
      <div class="settings-group">
        <label for="answer-time">–í—Ä–µ–º—è –Ω–∞ –æ—Ç–≤–µ—Ç (—Å–µ–∫—É–Ω–¥):</label>
        <select id="answer-time">
          <option value="15">15</option><option value="30" selected>30</option><option value="45">45</option><option value="60">60</option><option value="unlimited">–ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π</option>
        </select>
      </div>
      <div class="settings-group">
        <label for="penalty-mode">–®—Ç—Ä–∞—Ñ –∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:</label>
        <select id="penalty-mode">
          <option value="none" selected>–ë–µ–∑ —à—Ç—Ä–∞—Ñ–∞</option><option value="half">–ü–æ–ª–æ–≤–∏–Ω–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏</option><option value="full">–ü–æ–ª–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</option>
        </select>
      </div>
      <button class="small-btn" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button class="small-btn" onclick="closeSettings()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <div class="modal hidden" id="coinModal">
    <div class="modal-content">
      <h2>–û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–≤—ã–π —Ö–æ–¥</h2>
      <div class="coin" id="coin">
        <div class="face heads"></div>
        <div class="face tails"></div>
      </div>
      <div class="result" id="coinResult"></div>
      <button id="coinOk" class="small-btn hidden">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>
  </div>

  <div class="modal hidden" id="catModal">
    <div class="modal-content">
        <h2 style="font-size: 3rem; margin-bottom: 0.2em;"></h2>
        <h2>–ö–æ—Ç –≤ –º–µ—à–∫–µ!</h2>
        <p id="catTeamMessage" style="color: var(--text-dim); margin-bottom: 1.5em;"></p>
        <div class="buttons">
            <button class="big-btn" onclick="handleCatChoice('self')">–û—Ç–≤–µ—á–∞–µ–º —Å–∞–º–∏</button>
            <button class="big-btn" id="giveCatBtn" onclick="handleCatChoice('opponent')">–û—Ç–¥–∞—Ç—å —Å–æ–ø–µ—Ä–Ω–∏–∫—É</button>
        </div>
    </div>
  </div>

  <!-- –ò–ó–ú–ï–ù–ï–ù–û: –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –∑–≤–æ–Ω–∫–∞ –¥—Ä—É–≥—É -->
  <div class="modal hidden" id="phoneAFriendModal">
    <div class="modal-content">
        <h2 style="font-size: 3rem; margin-bottom: 0.2em;">üìû</h2>
        <h2>–ó–≤–æ–Ω–æ–∫ –¥—Ä—É–≥—É</h2>
        <p style="color: var(--text-dim); font-size: 1.2rem;">–ò–¥–µ—Ç –∑–≤–æ–Ω–æ–∫... –£ –≤–∞—Å –µ—Å—Ç—å 1 –º–∏–Ω—É—Ç–∞.</p>
        <div id="phoneTimerDisplay" class="modal-timer">60</div>
        <div class="buttons">
            <button class="big-btn" onclick="closePhoneAFriendModal()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>
  </div>

  <div id="question-box">
    <div id="timer-display"></div>
    <div id="media-container"></div>
    <div id="question"></div>
    <div class="options" id="options"></div>
    <div id="host-controls" class="hidden">
        <button class="big-btn host-btn-correct" onclick="hostCheckAnswer(true)">‚úÖ –í–µ—Ä–Ω–æ</button>
        <button class="big-btn host-btn-incorrect" onclick="hostCheckAnswer(false)">‚ùå –ù–µ–≤–µ—Ä–Ω–æ</button>
    </div>
    <div id="lifeline-controls">
      <button id="fifty-fifty-btn" class="small-btn">50/50</button>
      <button id="phone-a-friend-btn" class="small-btn"> –ó–≤–æ–Ω–æ–∫ –¥—Ä—É–≥—É</button>
    </div>
  </div>

  <div id="final-result"></div>

  <audio id="bg-music" src="https://www.myinstants.com/media/sounds/music-box-game-over-sound-effect-hd.mp3" loop></audio>

  <script>
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(frequency, duration, type = 'sine') {
      try {
        const oscillator = audioContext.createOscillator(); const gainNode = audioContext.createGain();
        oscillator.connect(gainNode); gainNode.connect(audioContext.destination);
        oscillator.frequency.value = frequency; oscillator.type = type;
        gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
        oscillator.start(audioContext.currentTime); oscillator.stop(audioContext.currentTime + duration);
      } catch(e) { console.warn("Web Audio API not supported."); }
    }
    const playClick = () => playSound(600, 0.08, 'triangle');
    const playSuccess = () => { playSound(523, 0.1); setTimeout(() => playSound(783, 0.15), 120); };
    const playError = () => playSound(200, 0.2, 'square');
    const bgAnimation = document.getElementById('bgAnimation');
    const culturalSymbols = ['üèõÔ∏è','üìú','üè∫','üé≠','üóø','‚ò•','‚òØÔ∏è','‚öúÔ∏è','‚ú°Ô∏è','‚ò™Ô∏è','üïâÔ∏è','‚òÆÔ∏è','‚úíÔ∏è','üé®','üéº'];
    for (let i = 0; i < 25; i++) {
      const symbol = document.createElement('div'); symbol.className = 'bg-symbol';
      symbol.textContent = culturalSymbols[Math.floor(Math.random() * culturalSymbols.length)];
      symbol.style.left = `${Math.random() * 95}%`; symbol.style.animationDuration = `${Math.random() * 10 + 10}s`;
      symbol.style.fontSize = `${Math.random() * 1.8 + 0.9}rem`; symbol.style.animationDelay = `-${Math.random() * 15}s`;
      bgAnimation.appendChild(symbol);
    }
    function shuffleArray(array) {
      const newArray = [...array];
      for (let i = newArray.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [newArray[i], newArray[j]] = [newArray[j], newArray[i]]; }
      return newArray;
    }
    function triggerConfetti() {
        const colors = ['#ffd700', '#4a9eff', '#ff4d4d', '#4dd0e1', '#f48fb1'];
        for (let i = 0; i < 150; i++) {
            const confetti = document.createElement('div'); confetti.className = 'confetti-piece';
            confetti.style.left = `${Math.random() * 100}vw`; confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animationDuration = `${Math.random() * 3 + 4}s`; confetti.style.animationDelay = `${Math.random() * 3}s`;
            confetti.style.transform = `rotate(${Math.random() * 360}deg)`; document.body.appendChild(confetti);
            confetti.addEventListener('animationend', () => confetti.remove());
        }
    }
    const categories = [ { id: "–ü–µ—Ä–≤–æ–±—ã—Ç–Ω–æ—Å—Ç—å", questions: [ { value: 200, question: "–ö–∞–∫–æ–π –ø–µ—Ä–∏–æ–¥ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–µ–¥—à–µ—Å—Ç–≤—É–µ—Ç –ø–æ—è–≤–ª–µ–Ω–∏—é –ø–∏—Å—å–º–µ–Ω–Ω–æ—Å—Ç–∏?", correct: "–ü–µ—Ä–≤–æ–±—ã—Ç–Ω–æ—Å—Ç—å", options: ["–ê–Ω—Ç–∏—á–Ω–æ—Å—Ç—å", "–°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—å–µ", "–ü–µ—Ä–≤–æ–±—ã—Ç–Ω–æ—Å—Ç—å", "–ù–æ–≤–æ–µ –≤—Ä–µ–º—è"] }, { value: 400, question: "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–ª–∏—Å—å –¥—Ä–µ–≤–Ω–µ–π—à–∏–µ –æ—Ä—É–¥–∏—è —Ç—Ä—É–¥–∞ —á–µ–ª–æ–≤–µ–∫–∞?", correct: "–ö–∞–º–µ–Ω–Ω—ã–µ", options: ["–ñ–µ–ª–µ–∑–Ω—ã–µ", "–ö–∞–º–µ–Ω–Ω—ã–µ", "–ë—Ä–æ–Ω–∑–æ–≤—ã–µ", "–ú–µ–¥–Ω—ã–µ"] }, { value: 600, question: "–ö–∞–∫–∞—è —Ä–µ–∫–∞ —Å—á–∏—Ç–∞–ª–∞—Å—å —Å–≤—è—â–µ–Ω–Ω–æ–π –≤ –î—Ä–µ–≤–Ω–µ–π –ò–Ω–¥–∏–∏?", correct: "–ì–∞–Ω–≥", options: ["–ù–∏–ª", "–¢–∏–≥—Ä", "–ì–∞–Ω–≥", "–Ø–Ω—Ü–∑—ã"] }, { value: 800, question: "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–ª–∏—Å—å –¥—Ä–µ–≤–Ω–∏–µ –æ–±—â–∏–Ω—ã, –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–µ –∫—Ä–æ–≤–Ω—ã–º —Ä–æ–¥—Å—Ç–≤–æ–º?", correct: "–†–æ–¥–æ–≤—ã–µ –æ–±—â–∏–Ω—ã", options: ["–ü–ª–µ–º–µ–Ω–∞", "–†–æ–¥–æ–≤—ã–µ –æ–±—â–∏–Ω—ã", "–ì–æ—Ä–æ–¥–∞", "–ò–º–ø–µ—Ä–∏–∏"] }, { value: 1000, question: "–ö–∞–∫–æ–π –∞—Ä—Ö–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–∞–º—è—Ç–Ω–∏–∫ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —ç–ø–æ—Ö–µ –±—Ä–æ–Ω–∑—ã –∏ —Å–≤—è–∑–∞–Ω —Å –∫—É–ª—å—Ç—É—Ä–æ–π –ê–Ω–¥—Ä–æ–Ω–æ–≤—Ü–µ–≤?", correct: "–ë–µ–≥–∞–∑—ã-–î–∞–Ω–¥—ã–±–∞–µ–≤—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞", options: ["–ê–Ω–¥—Ä–æ–Ω–æ–≤—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞", "–ë–µ–≥–∞–∑—ã-–î–∞–Ω–¥—ã–±–∞–µ–≤—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞", "–°–∞–∫–∏", "–°–æ–≥–¥–∏–∞–Ω–∞"] } ] }, { id: "–†–∞–±–æ–≤–ª–∞–¥–µ–ª—å—á–µ—Å—Ç–≤–æ", questions: [ { value: 200, question: "–ö–∞–∫–∞—è —Ä–µ–∫–∞ –±—ã–ª–∞ –æ—Å–Ω–æ–≤–æ–π –∂–∏–∑–Ω–∏ –∏ –ø—Ä–æ—Ü–≤–µ—Ç–∞–Ω–∏—è –î—Ä–µ–≤–Ω–µ–≥–æ –ï–≥–∏–ø—Ç–∞?", correct: "–ù–∏–ª", options: ["–¢–∏–≥—Ä", "–ï–≤—Ñ—Ä–∞—Ç", "–ù–∏–ª", "–ò–Ω–¥"] }, { value: 400, question: "–í –∫–∞–∫–æ–π –¥—Ä–µ–≤–Ω–µ–π —Å—Ç—Ä–∞–Ω–µ, —Å–æ–≥–ª–∞—Å–Ω–æ –ª–µ–≥–µ–Ω–¥–µ, –Ω–∞—Ö–æ–¥–∏–ª–∏—Å—å –í–∏—Å—è—á–∏–µ —Å–∞–¥—ã –°–µ–º–∏—Ä–∞–º–∏–¥—ã?", correct: "–í–∞–≤–∏–ª–æ–Ω", options: ["–ï–≥–∏–ø–µ—Ç", "–ê—Å—Å–∏—Ä–∏—è", "–í–∞–≤–∏–ª–æ–Ω", "–ü–µ—Ä—Å–∏—è"] }, { value: 600, question: "–ö–∞–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–∏—Å—å–º–∞, –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ –≤—ã–¥–∞–≤–ª–∏–≤–∞–Ω–∏–∏ –∑–Ω–∞–∫–æ–≤ –Ω–∞ –≥–ª–∏–Ω–µ, —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞ –≤ –®—É–º–µ—Ä–µ?", correct: "–ö–ª–∏–Ω–æ–ø–∏—Å—å", options: ["–ò–µ—Ä–æ–≥–ª–∏—Ñ—ã", "–ö–ª–∏–Ω–æ–ø–∏—Å—å", "–ê–ª—Ñ–∞–≤–∏—Ç", "–ü–∏–∫—Ç–æ–≥—Ä–∞—Ñ–∏—è"] }, { value: 800, question: "–ö–∞–∫–∏–µ –¥—Ä–µ–≤–Ω–∏–µ –ø–ª–µ–º–µ–Ω–∞ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞ –≤–µ–ª–∏ –∫–æ—á–µ–≤–æ–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏ –∏ –±—ã–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω—ã —Å–≤–æ–∏–º–∏ –±—Ä–æ–Ω–∑–æ–≤—ã–º–∏ –∏–∑–¥–µ–ª–∏—è–º–∏?", correct: "–°–∞–∫–∏", options: ["–°–∫–∏—Ñ—ã", "–°–∞–∫–∏", "–£–π—Å—É–Ω—å", "–ö–∞–Ω–≥—é–π"] }, { value: 1000, question: "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–≤—è—â–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∑–æ—Ä–æ–∞—Å—Ç—Ä–∏–∑–º–∞, –¥—Ä–µ–≤–Ω–µ–π —Ä–µ–ª–∏–≥–∏–∏ –ü–µ—Ä—Å–∏–∏?", correct: "–ê–≤–µ—Å—Ç–∞", options: ["–¢–∞–ª–º—É–¥", "–ê–≤–µ—Å—Ç–∞", "–í–µ–¥—ã", "–¢–∏–ø–∏—Ç–∞–∫–∞"] } ] }, { id: "–ê–Ω—Ç–∏—á–Ω–æ—Å—Ç—å", questions: [ { value: 200, question: "–ö–∞–∫–∏–µ –≥–æ—Ä–æ–¥–∞-–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–∞ –î—Ä–µ–≤–Ω–µ–π –ì—Ä–µ—Ü–∏–∏ –Ω–∞–∑—ã–≤–∞–ª–∏—Å—å –ø–æ–ª–∏—Å–∞–º–∏?", correct: "–ü–æ–ª–∏—Å—ã", options: ["–ü—Ä–æ–≤–∏–Ω—Ü–∏–∏", "–ü–æ–ª–∏—Å—ã", "–ò–º–ø–µ—Ä–∏–∏", "–§–µ–æ–¥–∞–ª—å–Ω—ã–µ –≤–ª–∞–¥–µ–Ω–∏—è"] }, { value: 400, question: "–ö—Ç–æ –±—ã–ª –±–æ–≥–æ–º –≥—Ä–æ–º–∞ –∏ –º–æ–ª–Ω–∏–π –≤ –¥—Ä–µ–≤–Ω–µ–≥—Ä–µ—á–µ—Å–∫–æ–π –º–∏—Ñ–æ–ª–æ–≥–∏–∏?", correct: "–ó–µ–≤—Å", options: ["–ê–ø–æ–ª–ª–æ–Ω", "–ê—Ä–µ—Å", "–ó–µ–≤—Å", "–ü–æ—Å–µ–π–¥–æ–Ω"] }, { value: 600, question: "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–ª–∞—Å—å –≥–ª–∞–≤–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–∞—è –∏ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–ª–æ—â–∞–¥—å –≤ –î—Ä–µ–≤–Ω–∏—Ö –ê—Ñ–∏–Ω–∞—Ö?", correct: "–ê–≥–æ—Ä–∞", options: ["–§–æ—Ä—É–º", "–ê–≥–æ—Ä–∞", "–ê–∫—Ä–æ–ø–æ–ª—å", "–ö–æ–ª–∏–∑–µ–π"] }, { value: 800, question: "–ö–∞–∫–æ–π —Ñ–∏–ª–æ—Å–æ—Ñ, –∞–≤—Ç–æ—Ä —Ç—Ä—É–¥–∞ ¬´–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ¬ª, –±—ã–ª —É—á–µ–Ω–∏–∫–æ–º –°–æ–∫—Ä–∞—Ç–∞?", correct: "–ü–ª–∞—Ç–æ–Ω", options: ["–ê—Ä–∏—Å—Ç–æ—Ç–µ–ª—å", "–ü–ª–∞—Ç–æ–Ω", "–°–æ–∫—Ä–∞—Ç", "–ì–µ—Ä–æ–¥–æ—Ç"] }, { value: 1000, question: "–ö–∞–∫ –∑–≤–∞–ª–∏ —Ñ–∏–ª–æ—Å–æ—Ñ–∞-–∫–∏–Ω–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–π, –ø–æ –ª–µ–≥–µ–Ω–¥–µ, –∂–∏–ª –≤ –±–æ—á–∫–µ?", correct: "–î–∏–æ–≥–µ–Ω", options: ["–ü–∏—Ñ–∞–≥–æ—Ä", "–î–∏–æ–≥–µ–Ω", "–≠–ø–∏–∫—É—Ä", "–ó–µ–Ω–æ–Ω"] } ] }, { id: "–°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—å–µ", questions: [ { value: 200, question: "–ö–∞–∫–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Å—Ç–∏–ª—å, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É—é—â–∏–π—Å—è –º–∞—Å—Å–∏–≤–Ω—ã–º–∏ —Å—Ç–µ–Ω–∞–º–∏ –∏ –ø–æ–ª—É–∫—Ä—É–≥–ª—ã–º–∏ –∞—Ä–∫–∞–º–∏, –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–ª –≤ –ï–≤—Ä–æ–ø–µ –≤ X‚ÄìXII –≤–µ–∫–∞—Ö?", correct: "–†–æ–º–∞–Ω—Å–∫–∏–π —Å—Ç–∏–ª—å", options: ["–ì–æ—Ç–∏–∫–∞", "–ë–∞—Ä–æ–∫–∫–æ", "–†–æ–º–∞–Ω—Å–∫–∏–π —Å—Ç–∏–ª—å", "–†–µ–Ω–µ—Å—Å–∞–Ω—Å"] }, { value: 400, audio: "https://www.myinstants.com/media/sounds/prokofiev-dance-of-the-knights.mp3", question: "–ü–æ—Å–ª—É—à–∞–π—Ç–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç. –ö–∞–∫–æ–π –∫–æ–º–ø–æ–∑–∏—Ç–æ—Ä –Ω–∞–ø–∏—Å–∞–ª –∑–Ω–∞–º–µ–Ω–∏—Ç—ã–π ¬´–¢–∞–Ω–µ—Ü —Ä—ã—Ü–∞—Ä–µ–π¬ª?", correct: "–°–µ—Ä–≥–µ–π –ü—Ä–æ–∫–æ—Ñ—å–µ–≤", options: ["–ü—ë—Ç—Ä –ß–∞–π–∫–æ–≤—Å–∫–∏–π", "–î–º–∏—Ç—Ä–∏–π –®–æ—Å—Ç–∞–∫–æ–≤–∏—á", "–°–µ—Ä–≥–µ–π –ü—Ä–æ–∫–æ—Ñ—å–µ–≤", "–ò–≥–æ—Ä—å –°—Ç—Ä–∞–≤–∏–Ω—Å–∫–∏–π"] }, { value: 600, question: "–ö–∞–∫–∞—è —Ä–µ–ª–∏–≥–∏—è —Å—Ç–∞–ª–∞ –≥–æ—Å–ø–æ–¥—Å—Ç–≤—É—é—â–µ–π –≤ –ï–≤—Ä–æ–ø–µ –≤ –°—Ä–µ–¥–Ω–∏–µ –≤–µ–∫–∞?", correct: "–•—Ä–∏—Å—Ç–∏–∞–Ω—Å—Ç–≤–æ", options: ["–ò—Å–ª–∞–º", "–ë—É–¥–¥–∏–∑–º", "–•—Ä–∏—Å—Ç–∏–∞–Ω—Å—Ç–≤–æ", "–ò—É–¥–∞–∏–∑–º"] }, { value: 800, question: "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–ª—Å—è –≤–æ–µ–Ω–Ω–æ-–º–æ–Ω–∞—à–µ—Å–∫–∏–π –æ—Ä–¥–µ–Ω, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –≤ –ü–∞–ª–µ—Å—Ç–∏–Ω–µ –¥–ª—è –∑–∞—â–∏—Ç—ã –ø–∞–ª–æ–º–Ω–∏–∫–æ–≤?", correct: "–¢–∞–º–ø–ª–∏–µ—Ä—ã", options: ["–§—Ä–∞–Ω—Ü–∏—Å–∫–∞–Ω—Ü—ã", "–¢–∞–º–ø–ª–∏–µ—Ä—ã", "–î–æ–º–∏–Ω–∏–∫–∞–Ω—Ü—ã", "–ì–æ—Å–ø–∏—Ç–∞–ª—å–µ—Ä—ã"] }, { value: 1000, question: "–ö—Ç–æ –∏–∑–æ–±—Ä—ë–ª –∫–Ω–∏–≥–æ–ø–µ—á–∞—Ç–∞–Ω–∏–µ –≤ –ï–≤—Ä–æ–ø–µ –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ XV –≤–µ–∫–∞?", correct: "–ò–æ–≥–∞–Ω–Ω –ì—É—Ç–µ–Ω–±–µ—Ä–≥", options: ["–õ–µ–æ–Ω–∞—Ä–¥–æ –¥–∞ –í–∏–Ω—á–∏", "–ò–æ–≥–∞–Ω–Ω –ì—É—Ç–µ–Ω–±–µ—Ä–≥", "–ú–∞—Ä–∫–æ –ü–æ–ª–æ", "–†–æ–¥–∂–µ—Ä –ë—ç–∫–æ–Ω"] } ] }, { id: "–í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ", questions: [ { value: 200, question: "–ö—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–æ–º –∑–Ω–∞–º–µ–Ω–∏—Ç–æ–π –∫–∞—Ä—Ç–∏–Ω—ã ¬´–ú–æ–Ω–∞ –õ–∏–∑–∞¬ª (–î–∂–æ–∫–æ–Ω–¥–∞)?", correct: "–õ–µ–æ–Ω–∞—Ä–¥–æ –¥–∞ –í–∏–Ω—á–∏", options: ["–†–∞—Ñ–∞—ç–ª—å", "–ú–∏–∫–µ–ª–∞–Ω–¥–∂–µ–ª–æ", "–õ–µ–æ–Ω–∞—Ä–¥–æ –¥–∞ –í–∏–Ω—á–∏", "–ë–æ—Ç—Ç–∏—á–µ–ª–ª–∏"] }, { value: 400, question: "–ö–∞–∫–æ–µ —Ä–µ–ª–∏–≥–∏–æ–∑–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ —ç–ø–æ—Ö–∏ –í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏—è —Å—Ç—Ä–µ–º–∏–ª–æ—Å—å –∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é —Ö—Ä–∏—Å—Ç–∏–∞–Ω—Å–∫–æ–π —Ü–µ—Ä–∫–≤–∏?", correct: "–†–µ—Ñ–æ—Ä–º–∞—Ü–∏—è", options: ["–ö–æ–Ω—Ç—Ä—Ä–µ—Ñ–æ—Ä–º–∞—Ü–∏—è", "–†–µ—Ñ–æ—Ä–º–∞—Ü–∏—è", "–†–µ–Ω–µ—Å—Å–∞–Ω—Å", "–ì—É–º–∞–Ω–∏–∑–º"] }, { value: 600, question: "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–∞–∫—Ç–∞—Ç ¬´–ì–æ—Å—É–¥–∞—Ä—å¬ª, –≥–¥–µ —Ü–µ–ª—å –æ–ø—Ä–∞–≤–¥—ã–≤–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞?", correct: "–ù–∏–∫–∫–æ–ª–æ –ú–∞–∫–∏–∞–≤–µ–ª–ª–∏", options: ["–≠—Ä–∞–∑–º –†–æ—Ç—Ç–µ—Ä–¥–∞–º—Å–∫–∏–π", "–ù–∏–∫–∫–æ–ª–æ –ú–∞–∫–∏–∞–≤–µ–ª–ª–∏", "–¢–æ–º–∞—Å –ú–æ—Ä", "–ü–µ—Ç—Ä–∞—Ä–∫–∞"] }, { value: 800, question: "–ö–∞–∫–æ–π —Ö—É–¥–æ–∂–Ω–∏–∫ –∏ —Å–∫—É–ª—å–ø—Ç–æ—Ä —Ä–∞—Å–ø–∏—Å–∞–ª –ø–æ—Ç–æ–ª–æ–∫ –°–∏–∫—Å—Ç–∏–Ω—Å–∫–æ–π –∫–∞–ø–µ–ª–ª—ã –≤ –í–∞—Ç–∏–∫–∞–Ω–µ?", correct: "–ú–∏–∫–µ–ª–∞–Ω–¥–∂–µ–ª–æ", options: ["–õ–µ–æ–Ω–∞—Ä–¥–æ –¥–∞ –í–∏–Ω—á–∏", "–ú–∏–∫–µ–ª–∞–Ω–¥–∂–µ–ª–æ", "–†–∞—Ñ–∞—ç–ª—å", "–¢–∏—Ü–∏–∞–Ω"] }, { value: 1000, question: "–ö–∞–∫–æ–π –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –¥—Ä–∞–º–∞—Ç—É—Ä–≥ —è–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–æ–º —Ç—Ä–∞–≥–µ–¥–∏–π ¬´–ì–∞–º–ª–µ—Ç¬ª –∏ ¬´–†–æ–º–µ–æ –∏ –î–∂—É–ª—å–µ—Ç—Ç–∞¬ª?", correct: "–£–∏–ª—å—è–º –®–µ–∫—Å–ø–∏—Ä", options: ["–ö—Ä–∏—Å—Ç–æ—Ñ–µ—Ä –ú–∞—Ä–ª–æ", "–£–∏–ª—å—è–º –®–µ–∫—Å–ø–∏—Ä", "–ë–µ–Ω –î–∂–æ–Ω—Å–æ–Ω", "–î–∂–æ–Ω –ú–∏–ª—å—Ç–æ–Ω"] } ] }, { id: "–ù–æ–≤–æ–µ –∏ –Ω–æ–≤–µ–π—à–µ–µ –≤—Ä–µ–º—è", questions: [ { value: 200, question: "–í –∫–∞–∫–æ–º –≤–µ–∫–µ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –í–µ–ª–∏–∫–∞—è —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∞—è —Ä–µ–≤–æ–ª—é—Ü–∏—è?", correct: "XVIII –≤–µ–∫", options: ["XVII –≤–µ–∫", "XVIII –≤–µ–∫", "XIX –≤–µ–∫", "XVI –≤–µ–∫"] }, { value: 400, question: "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∑–Ω–∞–º–µ–Ω–∏—Ç–æ–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –õ—é–¥–≤–∏–≥–∞ –≤–∞–Ω –ë–µ—Ç—Ö–æ–≤–µ–Ω–∞?", correct: "–õ—É–Ω–Ω–∞—è —Å–æ–Ω–∞—Ç–∞", options: ["–ü–∞—Å—Ç–æ—Ä–∞–ª—å–Ω–∞—è —Å–∏–º—Ñ–æ–Ω–∏—è", "–õ—É–Ω–Ω–∞—è —Å–æ–Ω–∞—Ç–∞", "–û–¥–∞ –∫ —Ä–∞–¥–æ—Å—Ç–∏", "–ü—è—Ç–∞—è —Å–∏–º—Ñ–æ–Ω–∏—è"] }, { value: 600, image: "https://media.discordapp.net/attachments/1344289233447419926/1427219339567829076/van_gogh.jpg?format=webp&width=1010&height=800", question: "–ö—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–æ–º —ç—Ç–æ–π –∫–∞—Ä—Ç–∏–Ω—ã –≤ —Å—Ç–∏–ª–µ –ø–æ—Å—Ç–∏–º–ø—Ä–µ—Å—Å–∏–æ–Ω–∏–∑–º–∞?", correct: "–í–∏–Ω—Å–µ–Ω—Ç –≤–∞–Ω –ì–æ–≥", options: ["–ö–ª–æ–¥ –ú–æ–Ω–µ", "–ü–æ–ª—å –ì–æ–≥–µ–Ω", "–í–∏–Ω—Å–µ–Ω—Ç –≤–∞–Ω –ì–æ–≥", "–ü–æ–ª—å –°–µ–∑–∞–Ω–Ω"] }, { value: 800, question: "–ö—Ç–æ —Å–æ–∑–¥–∞–ª –∫–∞—Ä—Ç–∏–Ω—É ¬´–°–≤–æ–±–æ–¥–∞, –≤–µ–¥—É—â–∞—è –Ω–∞—Ä–æ–¥¬ª, –ø–æ—Å–≤—è—â—ë–Ω–Ω—É—é –ò—é–ª—å—Å–∫–æ–π —Ä–µ–≤–æ–ª—é—Ü–∏–∏ 1830 –≥–æ–¥–∞?", correct: "–≠–∂–µ–Ω –î–µ–ª–∞–∫—Ä—É–∞", options: ["–§—Ä–∞–Ω—Å–∏—Å–∫–æ –ì–æ–π—è", "–≠–∂–µ–Ω –î–µ–ª–∞–∫—Ä—É–∞", "–ñ–∞–∫-–õ—É–∏ –î–∞–≤–∏–¥", "–¢–µ–æ–¥–æ—Ä –ñ–µ—Ä–∏–∫–æ"] }, { value: 1000, question: "–ö–∞–∫–æ–π —Ñ–∏–ª–æ—Å–æ—Ñ, –∞–≤—Ç–æ—Ä ¬´–ö—Ä–∏—Ç–∏–∫–∏ —á–∏—Å—Ç–æ–≥–æ —Ä–∞–∑—É–º–∞¬ª, —è–≤–ª—è–µ—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π —Ñ–∏–≥—É—Ä–æ–π –Ω–µ–º–µ—Ü–∫–æ–π –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏?", correct: "–ò–º–º–∞–Ω—É–∏–ª –ö–∞–Ω—Ç", options: ["–í–æ–ª—å—Ç–µ—Ä", "–ò–º–º–∞–Ω—É–∏–ª –ö–∞–Ω—Ç", "–ì–µ–≥–µ–ª—å", "–†—É—Å—Å–æ"] } ] }, { id: "XX –≤–µ–∫ –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å", questions: [ { value: 200, question: "–ö—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–æ–º –∫–∞—Ä—Ç–∏–Ω—ã ¬´–ß—ë—Ä–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç¬ª?", correct: "–ö–∞–∑–∏–º–∏—Ä –ú–∞–ª–µ–≤–∏—á", options: ["–í–∞—Å–∏–ª–∏–π –ö–∞–Ω–¥–∏–Ω—Å–∫–∏–π", "–ö–∞–∑–∏–º–∏—Ä –ú–∞–ª–µ–≤–∏—á", "–ú–∞—Ä–∫ –®–∞–≥–∞–ª", "–ü–∞–±–ª–æ –ü–∏–∫–∞—Å—Å–æ"] }, { value: 400, question: "–ö–∞–∫–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –∏—Å–∫—É—Å—Å—Ç–≤–µ, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–µ –ü–∏–∫–∞—Å—Å–æ –∏ –ë—Ä–∞–∫–æ–º, –∏–∑–æ–±—Ä–∞–∂–∞–ª–æ –æ–±—ä–µ–∫—Ç—ã –≤ –≤–∏–¥–µ –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö —Ñ–æ—Ä–º?", correct: "–ö—É–±–∏–∑–º", options: ["–ö—É–±–∏–∑–º", "–°—é—Ä—Ä–µ–∞–ª–∏–∑–º", "–§—É—Ç—É—Ä–∏–∑–º", "–≠–∫—Å–ø—Ä–µ—Å—Å–∏–æ–Ω–∏–∑–º"] }, { value: 600, question: "–ö—Ç–æ –∏–∑–æ–±—Ä—ë–ª –ø–µ—Ä–≤—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω?", correct: "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ë–µ–ª–ª", options: ["–¢–æ–º–∞—Å –≠–¥–∏—Å–æ–Ω", "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ë–µ–ª–ª", "–ù–∏–∫–æ–ª–∞ –¢–µ—Å–ª–∞", "–ì—É–ª—å–µ–ª—å–º–æ –ú–∞—Ä–∫–æ–Ω–∏"] }, { value: 800, question: "–ö–∞–∫–æ–π –∏—Å–ø–∞–Ω—Å–∫–∏–π —Ö—É–¥–æ–∂–Ω–∏–∫-—Å—é—Ä—Ä–µ–∞–ª–∏—Å—Ç –∏–∑–≤–µ—Å—Ç–µ–Ω —Å–≤–æ–∏–º–∏ —Ä–∞–±–æ—Ç–∞–º–∏ —Å ¬´–ø–ª–∞–≤—è—â–∏–º–∏—Å—è —á–∞—Å–∞–º–∏¬ª?", correct: "–°–∞–ª—å–≤–∞–¥–æ—Ä –î–∞–ª–∏", options: ["–•–æ–∞–Ω –ú–∏—Ä–æ", "–ü–∞–±–ª–æ –ü–∏–∫–∞—Å—Å–æ", "–°–∞–ª—å–≤–∞–¥–æ—Ä –î–∞–ª–∏", "–†–µ–Ω–µ –ú–∞–≥—Ä–∏—Ç—Ç"] }, { value: 1000, question: "–ö–∞–∫–æ–µ –∫—É–ª—å—Ç—É—Ä–Ω–æ–µ —è–≤–ª–µ–Ω–∏–µ, –æ—Ç—Ä–∏—Ü–∞—é—â–µ–µ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –∫–∞–Ω–æ–Ω—ã –∏ –∏—â—É—â–µ–µ –Ω–æ–≤—ã–µ —Ñ–æ—Ä–º—ã, –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –º–æ–¥–µ—Ä–Ω–∏–∑–º, –∞–≤–∞–Ω–≥–∞—Ä–¥ –∏ –ø–æ—Å—Ç–º–æ–¥–µ—Ä–Ω?", correct: "–ü–æ—Å—Ç–º–æ–¥–µ—Ä–Ω–∏–∑–º", options: ["–°–æ—Ü—Ä–µ–∞–ª–∏–∑–º", "–ü–æ—Å—Ç–º–æ–¥–µ—Ä–Ω–∏–∑–º", "–ú–µ—Ç–∞–º–æ–¥–µ—Ä–Ω–∏–∑–º", "–ù–µ–æ–∫–ª–∞—Å—Å–∏—Ü–∏–∑–º"] } ] } ];
    
    function deepCopy(obj) { return JSON.parse(JSON.stringify(obj)); }
    function randomizeSpecialQuestions(categoriesData) {
        const NUM_CATS = 7; 
        const allQuestions = [];
        const possibleValues = [200, 400, 600, 800, 1000];
        const possibleCatTopics = ["–ò—Å—Ç–æ—Ä–∏—è –ò—Å–∫—É—Å—Å—Ç–≤", "–î—Ä–µ–≤–Ω–∏–µ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "–ú–∏—Ä–æ–≤—ã–µ –†–µ–ª–∏–≥–∏–∏", "–í–µ–ª–∏–∫–∏–µ –ü—Ä–∞–≤–∏—Ç–µ–ª–∏", "–ó–∞–±—ã—Ç—ã–µ –ò–º–ø–µ—Ä–∏–∏", "–ö—É–ª—å—Ç—É—Ä–Ω–æ–µ –ù–∞—Å–ª–µ–¥–∏–µ"];
        categoriesData.forEach(category => {
            category.questions.forEach(question => {
                delete question.type; delete question.catTopic; delete question.catValue;
                allQuestions.push(question);
            });
        });
        shuffleArray(allQuestions);
        for (let i = 0; i < NUM_CATS && i < allQuestions.length; i++) {
            const q = allQuestions[i];
            q.type = 'cat';
            q.catTopic = possibleCatTopics[Math.floor(Math.random() * possibleCatTopics.length)];
            q.catValue = possibleValues[Math.floor(Math.random() * possibleValues.length)];
        }
        return categoriesData;
    }

    const teamAInput = document.getElementById("teamA"), teamBInput = document.getElementById("teamB");
    const confirmBtn = document.getElementById("confirmBtn"), playBtn = document.getElementById("playBtn");
    const hint = document.querySelector(".hint"), coinModal = document.getElementById("coinModal");
    const coin = document.getElementById("coin"), coinResult = document.getElementById("coinResult"), coinOk = document.getElementById("coinOk");
    const timerDisplay = document.getElementById('timer-display'), bgMusic = document.getElementById('bg-music');
    const STORAGE_KEY = 'svoyaIgraState_culture_v11_fixed_turns';
    let timerInterval = null, timeLeft = 0;
    // –ò–ó–ú–ï–ù–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–∞–π–º–µ—Ä–∞ "–ó–≤–æ–Ω–∫–∞ –¥—Ä—É–≥—É"
    let phoneTimerInterval = null, phoneTimeLeft = 0;
    let totalQuestions = categories.reduce((acc, cat) => acc + cat.questions.length, 0);
    
    let gameState = {
        settings: {
            lifelines: { fiftyFifty: 3, phoneAFriend: 1 },
            answerTime: 30, penaltyMode: 'none', hostMode: false, volume: 0.1,
        },
        team1: { name: '', score: 0, lifelines: { fiftyFifty: 3, phoneAFriend: 1 } },
        team2: { name: '', score: 0, lifelines: { fiftyFifty: 3, phoneAFriend: 1 } },
        currentTurn: null, currentQuestion: null, answeredQuestions: {}, gameBoardData: null,
        gameStarted: false,
    };

    function saveGameState() { try { localStorage.setItem(STORAGE_KEY, JSON.stringify(gameState)); } catch (e) { console.error("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã:", e); } }
    function loadGameState() {
      try {
        const savedState = localStorage.getItem(STORAGE_KEY);
        if (savedState) {
          gameState = JSON.parse(savedState);
          if (gameState.gameStarted) {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            updateScoreboard(); updateTurnText(); buildBoard();
            bgMusic.volume = gameState.settings.volume;
            bgMusic.play().catch(e => {});
          } else {
             teamAInput.value = gameState.team1.name; teamBInput.value = gameState.team2.name;
             if (teamAInput.value && teamBInput.value) confirmBtn.click();
          }
        }
      } catch (e) { console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã:", e); localStorage.removeItem(STORAGE_KEY); }
    }
    
    confirmBtn.addEventListener("click", () => {
      playClick();
      const teamA = teamAInput.value.trim(), teamB = teamBInput.value.trim();
      if (!teamA || !teamB) {
        hint.textContent = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –æ–±–µ–∏—Ö –∫–æ–º–∞–Ω–¥"; hint.style.color = "#ff6b6b"; playError(); return;
      }
      playSuccess();
      gameState.team1.name = teamA; gameState.team2.name = teamB;
      hint.style.color = "#4a9eff"; hint.textContent = `–ö–æ–º–∞–Ω–¥—ã –≥–æ—Ç–æ–≤—ã: "${teamA}" –ø—Ä–æ—Ç–∏–≤ "${teamB}"`;
      confirmBtn.classList.add("hidden"); playBtn.classList.remove("hidden");
      teamAInput.disabled = true; teamBInput.disabled = true;
      saveGameState();
    });

    playBtn.addEventListener("click", () => {
      playClick(); coinModal.classList.remove("hidden"); coinResult.textContent = ""; coinOk.classList.add("hidden");
      coin.style.transform = 'rotateY(0deg)';
      setTimeout(() => {
        const isHeads = Math.random() > 0.5;
        const rotation = (6 + Math.floor(Math.random() * 2)) * 360 + (isHeads ? 0 : 180);
        coin.style.transform = `rotateY(${rotation}deg)`; playSound(440, 2.5, 'sawtooth');
        setTimeout(() => {
          playSuccess();
          gameState.currentTurn = isHeads ? 'team1' : 'team2';
          const winnerName = isHeads ? gameState.team1.name : gameState.team2.name;
          coinResult.textContent = isHeads ? `–í—ã–ø–∞–ª –û–†–ï–õ ‚Äî –Ω–∞—á–∏–Ω–∞–µ—Ç "${winnerName}"` : `–í—ã–ø–∞–ª–∞ –†–ï–®–ö–ê ‚Äî –Ω–∞—á–∏–Ω–∞–µ—Ç "${winnerName}"`;
          coinOk.classList.remove("hidden"); saveGameState();
        }, 2600);
      }, 400);
    });

    coinOk.addEventListener("click", () => {
      playClick(); coinModal.classList.add("hidden");
      const overlay = document.createElement("div");
      overlay.style.cssText = "position:fixed;inset:0;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;z-index:9999;font-size:10rem;color:var(--primary-glow);font-weight:900;";
      document.body.appendChild(overlay); let num = 3;
      const countdown = () => {
        if (num > 0) { overlay.textContent = num; playClick(); num--; setTimeout(countdown, 1000); }
        else {
          overlay.textContent = "–°–¢–ê–†–¢!"; playSuccess();
          setTimeout(() => { overlay.remove(); startGame(); }, 800);
        }
      }; countdown();
    });

    function showSettings() {
      playClick();
      document.getElementById('host-mode-toggle').checked = gameState.settings.hostMode;
      document.getElementById('volume-control').value = gameState.settings.volume;
      const parseVal = v => v === Infinity ? 'unlimited' : v;
      document.getElementById('lifelines-count-fifty').value = parseVal(gameState.settings.lifelines.fiftyFifty);
      document.getElementById('lifelines-count-phone').value = parseVal(gameState.settings.lifelines.phoneAFriend);
      document.getElementById('answer-time').value = gameState.settings.answerTime;
      document.getElementById('penalty-mode').value = gameState.settings.penaltyMode;
      document.getElementById('settingsModal').classList.remove('hidden');
    }

    function closeSettings() { playClick(); document.getElementById('settingsModal').classList.add('hidden'); }

    function saveSettings() {
      playClick();
      gameState.settings.hostMode = document.getElementById('host-mode-toggle').checked;
      gameState.settings.volume = document.getElementById('volume-control').value;
      bgMusic.volume = gameState.settings.volume;
      const parseCount = id => { const val = document.getElementById(id).value; return val === 'unlimited' ? Infinity : parseInt(val); };
      gameState.settings.lifelines.fiftyFifty = parseCount('lifelines-count-fifty');
      gameState.settings.lifelines.phoneAFriend = parseCount('lifelines-count-phone');
      gameState.settings.answerTime = document.getElementById('answer-time').value;
      gameState.settings.penaltyMode = document.getElementById('penalty-mode').value;
      if (!gameState.gameStarted) {
        gameState.team1.lifelines = { ...gameState.settings.lifelines }; 
        gameState.team2.lifelines = { ...gameState.settings.lifelines };
      }
      updateScoreboard(); closeSettings(); saveGameState(); playSuccess();
    }
    document.getElementById('volume-control').addEventListener('input', e => { bgMusic.volume = e.target.value; gameState.settings.volume = e.target.value; });

    function startGame() {
      gameState.gameStarted = true; gameState.gameBoardData = randomizeSpecialQuestions(deepCopy(categories));
      bgMusic.play().catch(e => {});
      gameState.team1.lifelines = { ...gameState.settings.lifelines }; gameState.team2.lifelines = { ...gameState.settings.lifelines };
      document.getElementById('start-screen').classList.add('hidden'); document.getElementById('game-screen').classList.remove('hidden');
      updateScoreboard(); updateTurnText(); buildBoard(); saveGameState();
    }

    function updateTurnText() {
        const currentTeamName = gameState.currentTurn === 'team1' ? gameState.team1.name : gameState.team2.name;
        document.getElementById("turn-indicator").textContent = "–°–µ–π—á–∞—Å —Ö–æ–¥–∏—Ç: " + currentTeamName;
        document.getElementById('team1').classList.toggle('active-team', gameState.currentTurn === 'team1');
        document.getElementById('team2').classList.toggle('active-team', gameState.currentTurn === 'team2');
    }

    function updateScoreboard() {
        const formatLifeline = val => val === Infinity ? '‚àû' : val;
        ['team1', 'team2'].forEach(teamId => {
            document.getElementById(`${teamId}-name`).textContent = gameState[teamId].name;
            document.getElementById(`${teamId}-score`).textContent = gameState[teamId].score;
            document.getElementById(`${teamId}-fiftyFifty`).textContent = formatLifeline(gameState[teamId].lifelines.fiftyFifty);
            document.getElementById(`${teamId}-phoneAFriend`).textContent = formatLifeline(gameState[teamId].lifelines.phoneAFriend);
        });
    }

    function adjustScore(teamId, amount) {
        playClick(); gameState[teamId].score = Math.max(0, gameState[teamId].score + amount);
        updateScoreboard(); saveGameState();
    }

    function buildBoard() {
      const board = document.getElementById('board'); board.innerHTML = "";
      gameState.gameBoardData.forEach(cat => {
        const row = document.createElement("div");
        row.style.cssText = "display:grid;grid-template-columns:1.5fr repeat(5,1fr);gap:8px;align-items:center;";
        const title = document.createElement("div"); title.className = "category-title"; title.textContent = cat.id; row.appendChild(title);
        cat.questions.forEach(q => {
          const btn = document.createElement("div"); btn.className = "value-btn"; btn.textContent = q.value;
          const key = cat.id + q.value; btn.dataset.key = key;
          if(gameState.answeredQuestions[key]) btn.classList.add('used');
          else btn.onclick = () => onValueClick(key, q);
          row.appendChild(btn);
        }); board.appendChild(row);
      });
    }

    function onValueClick(key, questionData) {
      playClick(); gameState.currentQuestion = { key, ...questionData };
      if (questionData.type === 'cat') {
          playSound(600, 0.5, 'square');
          const currentTeamName = gameState[gameState.currentTurn].name;
          const opponentTeamName = (gameState.currentTurn === 'team1' ? gameState.team2 : gameState.team1).name;
          document.getElementById('catTeamMessage').textContent = `–ö–æ–º–∞–Ω–¥–∞ "${currentTeamName}", –≤—ã –¥–æ–ª–∂–Ω—ã —Ä–µ—à–∏—Ç—å: –±—É–¥–µ—Ç–µ –ª–∏ –≤—ã –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å –∏–∑ —Ç–µ–º—ã "${questionData.catTopic}" —Å—Ç–æ–∏–º–æ—Å—Ç—å—é ${questionData.catValue} –æ—á–∫–æ–≤, –∏–ª–∏ –æ—Ç–¥–∞–¥–∏—Ç–µ –µ–≥–æ –∫–æ–º–∞–Ω–¥–µ "${opponentTeamName}"?`;
          document.getElementById('giveCatBtn').textContent = `–û—Ç–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥–µ "${opponentTeamName}"`;
          document.getElementById('catModal').classList.remove('hidden'); return;
      }
      showQuestion(questionData);
    }
    
    function handleCatChoice(choice) {
        playClick();
        if (choice === 'opponent') { gameState.currentTurn = gameState.currentTurn === 'team1' ? 'team2' : 'team1'; updateTurnText(); }
        document.getElementById('catModal').classList.add('hidden');
        gameState.currentQuestion.value = gameState.currentQuestion.catValue;
        showQuestion(gameState.currentQuestion);
    }
    
    function showQuestion(questionData) {
        const mediaContainer = document.getElementById('media-container'); mediaContainer.innerHTML = '';
        if (questionData.image) { const img = document.createElement('img'); img.src = questionData.image; mediaContainer.appendChild(img); }
        if (questionData.audio) { const audio = document.createElement('audio'); audio.controls = true; audio.src = questionData.audio; audio.autoplay = true; mediaContainer.appendChild(audio); }
        document.getElementById('question').textContent = questionData.question;
        const optionsEl = document.getElementById('options'), hostControls = document.getElementById('host-controls'), lifelineControls = document.getElementById('lifeline-controls');
        if (gameState.settings.hostMode) {
            optionsEl.classList.add('hidden'); hostControls.classList.remove('hidden'); lifelineControls.classList.add('hidden');
        } else {
            optionsEl.classList.remove('hidden'); hostControls.classList.add('hidden'); lifelineControls.classList.remove('hidden');
            optionsEl.innerHTML = "";
            shuffleArray(questionData.options).forEach(opt => {
                const btn = document.createElement("button"); btn.className = "option-btn"; btn.textContent = opt;
                btn.onclick = () => checkAnswer(opt); optionsEl.appendChild(btn);
            });
        }
        const currentLifelines = gameState[gameState.currentTurn].lifelines;
        document.getElementById('fifty-fifty-btn').disabled = currentLifelines.fiftyFifty <= 0;
        document.getElementById('phone-a-friend-btn').disabled = currentLifelines.phoneAFriend <= 0;
        document.getElementById('question-box').style.display = "flex";
        startTimer(parseInt(gameState.settings.answerTime));
    }
    
    function checkAnswer(selected) {
        clearInterval(timerInterval);
        const isCorrect = selected === gameState.currentQuestion.correct;
        const { correct } = gameState.currentQuestion;
        Array.from(document.getElementById('options').children).forEach(btn => {
            btn.disabled = true;
            if (btn.textContent === correct) btn.classList.add('correct');
            else if (btn.textContent === selected) btn.classList.add('incorrect');
        });
        processAnswerResult(isCorrect);
    }

    function hostCheckAnswer(isCorrect) { clearInterval(timerInterval); processAnswerResult(isCorrect); }
    function showAnswerFeedback(isCorrect) {
        const feedbackEl = document.createElement('div'); feedbackEl.id = 'answer-feedback';
        feedbackEl.textContent = isCorrect ? '–í–µ—Ä–Ω–æ' : '–ù–µ–≤–µ—Ä–Ω–æ';
        feedbackEl.className = isCorrect ? 'correct' : 'incorrect';
        document.body.appendChild(feedbackEl);
        feedbackEl.addEventListener('animationend', () => feedbackEl.remove());
    }
    
    function processAnswerResult(isCorrect) {
        const { value, key } = gameState.currentQuestion;
        showAnswerFeedback(isCorrect);
        let penalty = 0;
        if (isCorrect) { playSuccess(); gameState[gameState.currentTurn].score += value; }
        else {
            playError();
            if (gameState.settings.penaltyMode === 'half') penalty = Math.floor(value / 2);
            else if (gameState.settings.penaltyMode === 'full') penalty = value;
            if (penalty > 0) gameState[gameState.currentTurn].score = Math.max(0, gameState[gameState.currentTurn].score - penalty);
        }
        updateScoreboard(); gameState.answeredQuestions[key] = true;
        document.querySelector(`[data-key='${key}']`).classList.add('used');
        
        setTimeout(() => {
            document.getElementById('question-box').style.display = "none";
            document.getElementById('media-container').innerHTML = '';
            if (Object.keys(gameState.answeredQuestions).length >= totalQuestions) {
                showWinner();
            } else {
                gameState.currentTurn = gameState.currentTurn === 'team1' ? 'team2' : 'team1';
                updateTurnText();
            }
            saveGameState();
        }, 2500);
    }

    function startTimer(duration) {
        clearInterval(timerInterval);
        timerDisplay.classList.remove('low-time');
        if (gameState.settings.answerTime === 'unlimited') { timerDisplay.textContent = '‚àû'; return; }
        
        timeLeft = duration;
        timerDisplay.textContent = timeLeft;
        timerInterval = setInterval(() => {
            timeLeft--;
            timerDisplay.textContent = timeLeft;
            if (timeLeft <= 5 && timeLeft > 0) { timerDisplay.classList.add('low-time'); playSound(800, 0.1, 'square'); }
            if (timeLeft <= 0) {
                clearInterval(timerInterval); playError();
                Array.from(document.getElementById('options').children).forEach(btn => btn.disabled = true);
                processAnswerResult(false);
            }
        }, 1000);
    }

    document.getElementById('fifty-fifty-btn').addEventListener('click', () => {
      playClick(); const teamLifelines = gameState[gameState.currentTurn].lifelines; if (teamLifelines.fiftyFifty <= 0) return;
      if (teamLifelines.fiftyFifty !== Infinity) teamLifelines.fiftyFifty--;
      updateScoreboard(); const correct = gameState.currentQuestion.correct;
      const incorrectOptions = Array.from(document.getElementById('options').children).filter(btn => btn.textContent !== correct);
      shuffleArray(incorrectOptions).slice(0, 2).forEach(btn => btn.classList.add('fifty-fifty-hidden'));
      document.getElementById('fifty-fifty-btn').disabled = true; saveGameState(); playSuccess();
    });

    document.getElementById('phone-a-friend-btn').addEventListener('click', () => {
        playClick(); 
        const teamLifelines = gameState[gameState.currentTurn].lifelines; 
        if (teamLifelines.phoneAFriend <= 0) return;
        
        if (teamLifelines.phoneAFriend !== Infinity) teamLifelines.phoneAFriend--;
        updateScoreboard(); 
        document.getElementById('phone-a-friend-btn').disabled = true;
        
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–π–º–µ—Ä
        clearInterval(timerInterval);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –∑–≤–æ–Ω–∫–∞
        document.getElementById('phoneAFriendModal').classList.remove('hidden');
        startPhoneTimer(60); // 60 —Å–µ–∫—É–Ω–¥ = 1 –º–∏–Ω—É—Ç–∞
        
        saveGameState(); 
        playSuccess();
    });
    
    // –ò–ó–ú–ï–ù–ï–ù–û: –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–∞–π–º–µ—Ä–∞ –∑–≤–æ–Ω–∫–∞
    function startPhoneTimer(duration) {
        phoneTimeLeft = duration;
        const display = document.getElementById('phoneTimerDisplay');
        display.textContent = phoneTimeLeft;
        
        clearInterval(phoneTimerInterval); // –û—á–∏—â–∞–µ–º –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π

        phoneTimerInterval = setInterval(() => {
            phoneTimeLeft--;
            display.textContent = phoneTimeLeft;
            if (phoneTimeLeft <= 0) {
                // –í—Ä–µ–º—è –≤—ã—à–ª–æ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ
                closePhoneAFriendModal();
            }
        }, 1000);
    }

    // –ò–ó–ú–ï–ù–ï–ù–û: –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞
    function closePhoneAFriendModal() {
        playClick();
        clearInterval(phoneTimerInterval); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –∑–≤–æ–Ω–∫–∞
        document.getElementById('phoneAFriendModal').classList.add('hidden');
        // –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–π–º–µ—Ä —Å –æ—Å—Ç–∞–≤—à–∏–º—Å—è –≤—Ä–µ–º–µ–Ω–µ–º
        startTimer(timeLeft);
    }

    function showWinner() {
      let winnerText;
      if (gameState.team1.score > gameState.team2.score) winnerText = ` –ü–æ–±–µ–¥–∏–ª–∞ –∫–æ–º–∞–Ω–¥–∞ "${gameState.team1.name}"!`;
      else if (gameState.team2.score > gameState.team1.score) winnerText = ` –ü–æ–±–µ–¥–∏–ª–∞ –∫–æ–º–∞–Ω–¥–∞ "${gameState.team2.name}"!`;
      else winnerText = " –ù–∏—á—å—è!";
      const finalResult = document.getElementById('final-result');
      finalResult.innerHTML = `${winnerText}<br><br>–ò—Ç–æ–≥–æ–≤—ã–π —Å—á—ë—Ç: ${gameState.team1.score} : ${gameState.team2.score}<br><br><button class="small-btn" onclick="resetGame()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>`;
      finalResult.style.display = "flex"; triggerConfetti(); playSuccess();
    }

    function resetGame() {
      playClick(); try { localStorage.removeItem(STORAGE_KEY); } catch (e) { console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã:", e); }
      location.reload();
    }
    
    window.addEventListener('DOMContentLoaded', loadGameState);
  </script>
</body>
</html>